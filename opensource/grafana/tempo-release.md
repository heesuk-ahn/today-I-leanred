# [번역] 대규모 확장이 가능한 분산 추적 시스템 Grafana Tempo 발표

* 해당 글은 https://grafana.com/blog/2020/10/27/announcing-grafana-tempo-a-massively-scalable-distributed-tracing-system/ 의 번역입니다.

그라파나 랩은 운영이 간편하고, 규모가 크며, 비용 효율적인 분산 추적 시스템인 Tempo 를 발표하게 된 것을 자랑스럽게 생각합니다.
Tempo 는 유일한 종속성이 오브젝트 스토리지 (GCS / S3) 인 강력한 추적 ID 조회 저장소로써 설계되었습니다.

## Why?

그라파나 랩에서는 다운샘플링된 분산 트레이싱 시스템에 대한 경험적인 면에서 실망스러운 부분들이 있었습니다.
샘플 트레이스를 찾는 것은 일반적으로 어렵지 않았지만, 엔지니어들은 반복적으로 특정 트레이스를 찾고 싶어했습니다.
우리는 추적 시스템이 "이 고객의 쿼리가 느린 이유가 무엇이죠?", "간헐적인 버그가 다시 나타났어요. 정확한 Trace 를 확인할 수 있을까요?" 와 같은 질문에 항상 대답할 수 있기를 원했습니다.
이런 질문에 답하기 위해서는 100% 샘플링이 되어야 하지만, 이를 위한 Elasticsearch 또는 Cassandra 클러스터를 관리하고 싶지는 않았습니다.
추가적으로, 우리는 우리의 백엔드 서버가 추적을 위한 색인을 생성할 필요가 없다는 것을 알았습니다. 우리는 logs and exampler  통해서 Trace 를 발견 할 수 있습니다. (Logs와 Exampler 는 Loki 관련인듯.)
우리가 어떤 Trace 를 추적하기 위해서 색인화 하는데에 비용을 지불하는 이유는 무엇일까요? 우리가 필요로하는 것은 간결하고 평균적인 트레이스 별 스토리지 머신 뿐이었습니다.
그래서 우리는 Tempo 를 만들었습니다.
 Tempo 는 현재 프로덕션, 스테이징 및 개발 환경의 전체 Read Path 를 14일 동안 수집, 저장 및 보유하고 있습니다. 24시간 내내 초당 170k 스팬을 consume 하고 배치 처리해서 GCS에 저장합니다.

## Grafana Integrations

### Log에서 Trace 로 연결

로그 라인의 trace id 에서 링크를 생성하도록 Loki 및 기타 로그 데이터 소스를 구성할 수 있습니다.
왜 굳이 Trace 에 대한 검색을 존재하는 Trace에서만 가능하도록 제한이 되어야 할까요? Log 를 사용하면, Path, Status Code, Latency, user, ip, 또는 Trace ID 와 동일한
로그 검색을 할 수도 있습니다.
 아래와 같은 line 을 고려해봅시다.

```
path=/api/v1/users status=500 latency=25ms traceid=598083459f85afab userid=4928
```

위에 있는 모든 필드는 Tempo 에서 Trace ID 에 대한 검색 가능한 index 를 제공합니다. 이미 로깅 시스템을 구축하기 위해서 우리는 시간과 돈을 투자했습니다.
구축된 로깅 시스템을 활용하여서 Trace 또한 찾는 것이 효율적입니다!

### Metrics 에서 Trace 로 연결

마침내 `Exampler` 를 오픈소스로써 이용할 수 있습니다. 이제 Traces 는 메트릭으로 부터 직접 검색할 수 있습니다.

(위의 이미지를 살펴보면 PromQL 로 duration 중 99th로 느린 요청 컨텍스트를 Exampler 라는 탭에서 TraceId 를 확인할 수 있다)
Logs를 사용하면 기록된 필드를 기반으로 검색중인 정확한 Trace 를 찾을 수 있습니다. 그라파나 그래프에 직접 임베디드된 메트릭 쿼리를 기반으로
Trace에 대한 링크를 얻을 수 있습니다.
 Prometheus 쿼리를 사용하여 p99, 500 오류 코드, 특정 엔드 포인트를 호출하면 모든 트레이스가 현재 보고있는 examples 의 패턴이 됩니다.

### Trace 에서 다른 모든것으로 연결

검색을 위한 Examplears and Logs 와 그리고 Tempo를 위한 모든 것들을...음..청구서에 대해 걱정하지 않고 모든 것을 저장합니다.
한 단계 더 나아가 관찰성 데이터를 연결하는 새로운 방법을 추가해보겠습니다. Trace에서 로그로 다시 연결하는 것은 어떨까요?
Grafana Cloud Agent 를 사용하면 일관된 메타 데이터로 Trace, Log 및 Metric을 decorate 할 수 있고, 이를 통해 이전에는
불가능했던 상관 관계를 생성할 수 있습니다.
 Examplar 에서 Trace 로 이동 한 후에 운영자는 이제 문제가 있는 서비스의 로그로 직접 이동할 수 있습니다!
Trace 는 요청 경로에 어떤 요소가 오류를 일으켰는지 즉시 식별하고 로그는 이유를 식별하는데에 도움이 됩니다.
